<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ODMS.mapper.DocMapper">

    <resultMap id="DocumentListMap" type="ODMS.entity.DocumentList">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="type" property="type"/>
        <result column="department" property="department"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <resultMap id="DocumentMap" type="ODMS.entity.Document">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="type" property="type"/>
        <result column="content" property="content"/>
        <result column="excerpt" property="excerpt"/>
        <result column="department" property="department"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <select id="searchDocuments" resultMap="DocumentListMap">
        SELECT id,title,type,department,updated_at FROM odmsdb.documents
        WHERE 1=1
        <if test="keyword != null and keyword != ''">
            AND (
            title LIKE CONCAT('%', #{keyword}, '%')
            OR content LIKE CONCAT('%', #{keyword}, '%')
            OR excerpt LIKE CONCAT('%', #{keyword}, '%')
            )
        </if>
        <if test="type != null and type != ''">
            AND type = #{type}
        </if>
        <if test="department != null and department != ''">
            AND department = #{department}
        </if>
        <if test="startDate != null">
            AND updated_at &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND updated_at &lt;= #{endDate}
        </if>
        ORDER BY updated_at DESC
    </select>
</mapper>